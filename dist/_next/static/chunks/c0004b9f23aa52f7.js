(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,7233,e=>{"use strict";let s=(0,e.i(75254).default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>s],7233)},16715,e=>{"use strict";let s=(0,e.i(75254).default)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);e.s(["RefreshCw",()=>s],16715)},27612,e=>{"use strict";let s=(0,e.i(75254).default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);e.s(["Trash2",()=>s],27612)},54943,e=>{"use strict";let s=(0,e.i(75254).default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);e.s(["default",()=>s])},34806,e=>{"use strict";var s=e.i(43476),a=e.i(71645),t=e.i(94433),r=e.i(17927),l=e.i(55894),i=e.i(67881),c=e.i(23750),n=e.i(10708),o=e.i(70065),d=e.i(30374),u=e.i(62870),m=e.i(94179),h=e.i(7233),p=e.i(27612);let x=(0,e.i(75254).default)("phone",[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]]);var f=e.i(31278),j=e.i(16715),v=e.i(31171),v=v,g=e.i(99219),g=g,y=e.i(54943),y=y;function N(){let{user:e}=(0,t.useAuth)(),[N,w]=(0,a.useState)([]),[C,b]=(0,a.useState)({}),[S,k]=(0,a.useState)(!0),[A,_]=(0,a.useState)(!1),[B,L]=(0,a.useState)(!1),[M,I]=(0,a.useState)(null),[T,D]=(0,a.useState)(""),[O,X]=(0,a.useState)(""),[R,P]=(0,a.useState)(""),[q,E]=(0,a.useState)("fixed"),[$,z]=(0,a.useState)(""),[F,V]=(0,a.useState)(""),[H,U]=(0,a.useState)(""),[K,W]=(0,a.useState)("");async function G(){k(!0);try{let s=await (0,l.getLocalCustomers)();w(s);let a={};for(let e of s)a[e.id]=await (0,l.getLocalCustomerAccounts)(e.id);b(a),(0,l.isOnline)()&&e&&await J()}catch(e){console.error("Error loading customers:",e)}finally{k(!1)}}async function J(){if(e){_(!0);try{let{data:s}=await r.supabaseBrowser.from("customers").select("*").eq("user_id",e.id).order("name");if(s){w(s);let e={};for(let a of s){let{data:s}=await r.supabaseBrowser.from("customer_accounts").select("*").eq("customer_id",a.id);e[a.id]=s||[]}b(e)}}catch(e){console.error("Error syncing customers:",e)}finally{_(!1)}}}async function Q(s){if(s.preventDefault(),!e)return;let a={user_id:e.id,name:O,phone:R||null,fee_type:q,fee_value:parseFloat($)||0};try{let e;if((0,l.isOnline)()){let{data:s,error:t}=await r.supabaseBrowser.from("customers").insert(a).select().single();if(t)throw t;e=s.id,await (0,l.saveLocalCustomer)(s),w(e=>[...e,s])}else{e=`temp-${Date.now()}`;let s={...a,id:e,created_at:new Date().toISOString()};await (0,l.saveLocalCustomer)(s),w(e=>[...e,s])}if(H){let s={customer_id:e,account_title:F||O,account_number:H,bank_name:K||"Bank",type:"bank"};if((0,l.isOnline)()){let{data:a}=await r.supabaseBrowser.from("customer_accounts").insert(s).select().single();a&&(await (0,l.saveLocalCustomerAccount)(a),b(s=>({...s,[e]:[...s[e]||[],a]})))}else{let a={...s,id:`temp-acc-${Date.now()}`,created_at:new Date().toISOString()};await (0,l.saveLocalCustomerAccount)(a),b(s=>({...s,[e]:[...s[e]||[],a]}))}}X(""),P(""),E("fixed"),z(""),V(""),U(""),W(""),L(!1)}catch(e){console.error("Error creating customer:",e)}}async function Y(e){if(confirm("Are you sure?"))try{(0,l.isOnline)()&&!e.startsWith("temp-")&&await r.supabaseBrowser.from("customers").delete().eq("id",e),await (0,l.deleteLocalCustomer)(e),w(s=>s.filter(s=>s.id!==e))}catch(e){console.error("Error deleting customer:",e)}}(0,a.useEffect)(()=>{G()},[]);let Z=Array.from(new Map(N.map(e=>[e.id,e])).values()).filter(e=>e.name.toLowerCase().includes(T.toLowerCase())||e.phone&&e.phone.includes(T));return S?(0,s.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,s.jsx)(f.Loader2,{className:"h-8 w-8 animate-spin"})}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"Customers"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(y.default,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,s.jsx)(c.Input,{placeholder:"Search by name or phone...",value:T,onChange:e=>D(e.target.value),className:"pl-8 w-64"})]}),(0,s.jsxs)(i.Button,{variant:"outline",size:"sm",onClick:J,disabled:A,children:[(0,s.jsx)(j.RefreshCw,{className:`h-4 w-4 mr-2 ${A?"animate-spin":""}`})," Sync"]}),(0,s.jsxs)(d.Dialog,{open:B,onOpenChange:L,children:[(0,s.jsx)(d.DialogTrigger,{asChild:!0,children:(0,s.jsxs)(i.Button,{size:"sm",children:[(0,s.jsx)(h.Plus,{className:"h-4 w-4 mr-2"})," Add Customer"]})}),(0,s.jsxs)(d.DialogContent,{className:"max-w-md",children:[(0,s.jsx)(d.DialogHeader,{children:(0,s.jsx)(d.DialogTitle,{children:"Add New Customer"})}),(0,s.jsxs)("form",{onSubmit:Q,className:"space-y-4 mt-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(n.Label,{children:"Name"}),(0,s.jsx)(c.Input,{value:O,onChange:e=>X(e.target.value),required:!0})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(n.Label,{children:"Phone"}),(0,s.jsx)(c.Input,{value:R,onChange:e=>P(e.target.value),placeholder:"03XX-XXXXXXX"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(n.Label,{children:"Fee Type"}),(0,s.jsxs)(u.Select,{value:q,onValueChange:e=>E(e),children:[(0,s.jsx)(u.SelectTrigger,{children:(0,s.jsx)(u.SelectValue,{})}),(0,s.jsxs)(u.SelectContent,{children:[(0,s.jsx)(u.SelectItem,{value:"fixed",children:"Fixed (Rs.)"}),(0,s.jsx)(u.SelectItem,{value:"percentage",children:"Percentage (%)"})]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(n.Label,{children:"Fee Amount"}),(0,s.jsx)(c.Input,{type:"number",step:"0.01",value:$,onChange:e=>z(e.target.value),placeholder:"percentage"===q?"%":"Rs."})]})]}),(0,s.jsxs)("div",{className:"border-t pt-4 mt-4",children:[(0,s.jsx)("p",{className:"text-sm font-medium mb-2",children:"Bank Account (Optional)"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(c.Input,{placeholder:"Account Title",value:F,onChange:e=>V(e.target.value)}),(0,s.jsx)(c.Input,{placeholder:"Account Number",value:H,onChange:e=>U(e.target.value)}),(0,s.jsx)(c.Input,{placeholder:"Bank Name",value:K,onChange:e=>W(e.target.value)})]})]}),(0,s.jsx)(i.Button,{type:"submit",className:"w-full",children:"Add Customer"})]})]})]})]})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[Z.map(e=>(0,s.jsx)(o.Card,{className:"overflow-hidden",children:(0,s.jsxs)(o.CardContent,{className:"p-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"p-2 bg-primary/10 rounded-full",children:(0,s.jsx)("span",{className:"text-lg font-semibold",children:e.name.charAt(0).toUpperCase()})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-semibold",children:e.name}),e.phone&&(0,s.jsxs)("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[(0,s.jsx)(x,{className:"h-3 w-3"})," ",e.phone]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(m.Badge,{variant:"secondary",children:"percentage"===e.fee_type?`${e.fee_value}%`:`Rs. ${e.fee_value}`}),(0,s.jsx)(i.Button,{variant:"ghost",size:"sm",onClick:()=>{var s;I(M===(s=e.id)?null:s)},children:M===e.id?(0,s.jsx)(g.default,{className:"h-4 w-4"}):(0,s.jsx)(v.default,{className:"h-4 w-4"})}),(0,s.jsx)(i.Button,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive",onClick:()=>Y(e.id),children:(0,s.jsx)(p.Trash2,{className:"h-4 w-4"})})]})]}),M===e.id&&C[e.id]?.length>0&&(0,s.jsxs)("div",{className:"mt-4 pt-4 border-t space-y-2",children:[(0,s.jsx)("p",{className:"text-sm font-medium",children:"Bank Accounts:"}),C[e.id].map(e=>(0,s.jsxs)("div",{className:"text-sm pl-4 border-l-2 border-gray-200",children:[(0,s.jsx)("p",{className:"font-medium",children:e.account_title}),(0,s.jsxs)("p",{className:"text-muted-foreground",children:[e.bank_name," - ",e.account_number]})]},e.id))]})]})},e.id)),0===Z.length&&(0,s.jsx)(o.Card,{children:(0,s.jsx)(o.CardContent,{className:"py-8 text-center text-muted-foreground",children:T?"No customers found matching your search.":'No customers yet. Click "Add Customer" to create one.'})})]})]})}e.s(["default",()=>N],34806)}]);